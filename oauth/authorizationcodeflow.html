<!DOCTYPE html>
<html>
<title>Authorization code flow</title>
<style>
	input,
	a {
		display: block;
		margin: 20px 0;
	}
</style>

<head>
	<meta charset="UTF-8">
	<meta name="description" content="OAuth debugger">
	<meta name="keywords" content="OAuth debug jwt">
	<meta name="author" content="Guy Chauliac">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body onload="loadFromCookie()">
	<a
		href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/call-your-api-using-the-authorization-code-flow">Call
		your api using the authorizaton code flow auth0</a>

	<div>
		Authorize endpoint: <input type="text" size="128" id="authorize_endpoint">
		Token endpoint: <input type="text" size="128" id="token_endpoint">
		Client id: <input type="text" size="128" id="clientid">
		Secret: <input type="text" size="128" id="secret">
		Redirect url: <input type="text" size="128" id="redirect_url">
		Audience: <input type="text" size="128" id="audience">
		Scope: <input type="text" size="128" id="scope">
		Authorization request: <pre id="authrequest"></pre>
	</div>


	<button onClick="authorize()">Authorize</button>
	<button onClick="createRequest()">Show authorization request</button>
	<a href="/oauth/">Back</a>

	<script>
		function getInput(field) {
			return document.getElementById(field).value;
		}

		function setInput(field, value) {
			document.getElementById(field).value = value;
		}

		function setField(field, value) {
            document.getElementById(field).textContent = value;
        }

		function loadFromCookie() {
			setInput("clientid", getCookie("clientid"));
			setInput("secret", getCookie("secret"));
			setInput("redirect_url", getCookie("redirect_url"));
			setInput("authorize_endpoint",
				getCookie("authorize_endpoint"));
			setInput("token_endpoint", getCookie("token_endpoint"));
			setInput("audience", getCookie("audience"));
			setInput("scope", getCookie("scope"));
		}

		function storeInCookie() {
			document.cookie = "clientid=" + getInput("clientid")
				+ ";domain=.maxxq.org;path=/";
			document.cookie = "secret=" + getInput("secret")
				+ ";domain=.maxxq.org;path=/";
			document.cookie = "redirect_url="
				+ getInput("redirect_url")
				+ ";domain=.maxxq.org;path=/";
			document.cookie = "token_endpoint="
				+ getInput("token_endpoint")
				+ ";domain=.maxxq.org;path=/";
			document.cookie = "authorize_endpoint="
				+ getInput("authorize_endpoint")
				+ ";domain=.maxxq.org;path=/";
			document.cookie = "audience=" + getInput("audience")
				+ ";domain=.maxxq.org;path=/";
			document.cookie = "scope=" + getInput("scope")
				+ ";domain=.maxxq.org;path=/";
		}

		function getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2)
				return parts.pop().split(';').shift();
		}

		function createRequest(){
			var authRequest = getInput("authorize_endpoint")
				+ "?response_type=code" + "&client_id="
				+ getInput("clientid") + "&redirect_uri="
				+ getInput("redirect_url") + "&audience="
				+ getInput("audience") + "&scope="
				+ getInput("scope");
			setField("authrequest", authRequest);
			return authRequest;
		}

		function authorize() {
			storeInCookie();
			
			window.location.href = createRequest();
		}
	</script>
</body>

</html>