<html>
<body onload="getAccessToken()">
	<script>
            function getAccessToken(){
            	let mycookie = document.cookie;
                setCode("Waiting for code...");
                setToken("Waiting for token...");
                var code = getParameterByName("code");
                setCode(code);
                getAccessTokenFromAuthorizationServer(code);
            }
            
            function getAccessTokenFromAuthorizationServer(code){
            	fetch(getCookie("token_endpoint"), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'grant_type=authorization_code&client_id=' + getCookie("clientid") + '&client_secret=' + getCookie("secret") + '&code=' + code + '&redirect_uri=' + getCookie("redirect_url")
                })
                .then(response => response.json())
                .then(response => setToken(JSON.stringify(response)))
            }
  
            function setCode(code){
                document.getElementById("code").textContent = "Code: " + code;
            }
            
            function setToken(token){
                document.getElementById("token").textContent = "Token: " + token;
                //setDecodedToken(parseJwt(token));
            }
            
            function setDecodedToken(token){
                document.getElementById("decoded").textContent = "Deocded token: " + token;
            }

            function getParameterByName(name, url = window.location.href) {
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }
            
            function parseJwt(token) {
                var base64Url = token.split('.')[1];
                var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                return JSON.parse(jsonPayload);
            }
            
            function getCookie(name) {
            	  const value = `; ${document.cookie}`;
            	  const parts = value.split(`; ${name}=`);
            	  if (parts.length === 2) return parts.pop().split(';').shift();
            	}
        </script>
	<div id="code">Received code will go here</div>
	<div id="token">Received access token will go here</div>
	<div id="decoded">Deocded access token will go here</div>
	<br>
	<a href="https://jwt.io/">Decode the access token at jwt.io</a>
</body>
</html>